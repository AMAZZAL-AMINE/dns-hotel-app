"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const better_opn_1 = tslib_1.__importDefault(require("better-opn"));
const url_1 = require("../build/utils/url");
const EasCommand_1 = tslib_1.__importDefault(require("../commandUtils/EasCommand"));
const ora_1 = require("../ora");
const expoConfig_1 = require("../project/expoConfig");
const projectUtils_1 = require("../project/projectUtils");
const actions_1 = require("../user/actions");
class Open extends EasCommand_1.default {
    async runAsync() {
        const projectDir = await (0, projectUtils_1.findProjectRootAsync)();
        const exp = (0, expoConfig_1.getExpoConfig)(projectDir);
        // this ensures the project exists
        await (0, projectUtils_1.fetchProjectIdFromServerAsync)(exp);
        const user = await (0, actions_1.ensureLoggedInAsync)();
        const accountName = (0, projectUtils_1.getProjectAccountName)(exp, user);
        const projectName = exp.slug;
        const projectDashboardUrl = (0, url_1.getProjectDashboardUrl)(accountName, projectName);
        const failedMessage = `Unable to open a web browser. Project page is available at: ${projectDashboardUrl}`;
        const spinner = (0, ora_1.ora)(`Opening ${projectDashboardUrl}`).start();
        try {
            const opened = await (0, better_opn_1.default)(projectDashboardUrl);
            if (opened) {
                spinner.succeed(`Opened ${projectDashboardUrl}`);
            }
            else {
                spinner.fail(failedMessage);
            }
            return;
        }
        catch (error) {
            spinner.fail(failedMessage);
            throw error;
        }
    }
}
exports.default = Open;
Open.description = 'open the project page in a web browser';
